define(["require","exports","../ExpressionParser/Expression"],function(a,b,c){"use strict";var d=new c.Expression,e=new c.Expression;return function(a){var b=a.data,c=!1;if(d.IsValid&&d.Input===b.input.x.replace(/\s+/g,"")||(d.Parse(b.input.x),c=!0),e.IsValid&&e.Input===b.input.y.replace(/\s+/g,"")||(e.Parse(b.input.y),c=!0),!d.IsValid||!e.IsValid)return void self.postMessage({type:"error",error:{errorX:d.IsValid?"":d.Error,errorY:e.IsValid?"":e.Error}});self.postMessage({type:"parsed"});for(var f=Number(b.size),g=Number(b.bounds.left),h=Number(b.bounds.top),i=Number(b.bounds.right),j=(Number(b.bounds.bottom),(i-g)/f),k=f*f,l=4*k,m=new Float32Array(l),n=0,o=Date.now(),p=0;p<f;p++)for(var q=0;q<f;q++){var r=4*(p*f+q),s=g+q*j,t=h-p*j,u=d.getResult([{name:"x",value:s},{name:"y",value:t}]),v=e.getResult([{name:"x",value:s},{name:"y",value:t}]),w=Math.sqrt(Math.pow(u,2)+Math.pow(v,2));n=Math.max(n,w),m[r+0]=u/w,m[r+1]=v/w,m[r+2]=w}console.log("Compute field with parsed expressions took "+(Date.now()-o)+" ms"),self.postMessage({type:"value",field:{buffer:m.buffer,width:f,height:f,max:n}})}});