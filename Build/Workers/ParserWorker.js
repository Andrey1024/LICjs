define(["require","exports","../ExpressionParser/Expression"],function(a,b,c){"use strict";var d,e=new c.Expression,f=new c.Expression,g=0,h=0;return function(a){var b=a.data,c=!1;if(e.IsValid&&e.Input===b.input.x.replace(/\s+/g,"")||(e.Parse(b.input.x),c=!0),f.IsValid&&f.Input===b.input.y.replace(/\s+/g,"")||(f.Parse(b.input.y),c=!0),c||JSON.stringify(b.bounds)!==JSON.stringify(d.bounds)){if(!e.IsValid||!f.IsValid)return void self.postMessage({type:"error",error:{errorX:e.IsValid?"":e.Error,errorY:f.IsValid?"":f.Error}});self.postMessage({type:"parsed"});for(var i=Number(b.size),j=Number(b.bounds.left),k=Number(b.bounds.top),l=Number(b.bounds.right),m=(Number(b.bounds.bottom),(l-j)/i),n=i*i,o=4*n,p=new Float32Array(o),q=0,r=Date.now(),s=0;s<i;s++)for(var t=0;t<i;t++){var u=4*(s*i+t),v=j+t*m,w=k-s*m,x=e.getResult([{name:"x",value:v},{name:"y",value:w}]),y=f.getResult([{name:"x",value:v},{name:"y",value:w}]),z=Math.sqrt(Math.pow(x,2)+Math.pow(y,2));q=Math.max(q,z),p[u+0]=x/z,p[u+1]=y/z,p[u+2]=z}d=b,h++,g+=Date.now()-r,self.postMessage({type:"value",field:{buffer:p.buffer,width:i,height:i,max:q},time:g/h})}}});